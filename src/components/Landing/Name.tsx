import { styled } from "styled-components";
import { motion } from "framer-motion";
import { Html, Text, useScroll } from "@react-three/drei";
import Geomatic from "../../assets/Geomatic-Black.otf";
import { useEffect, useRef, useState } from "react";
//@ts-ignore
import { NodeToyMaterial } from "@nodetoy/react-nodetoy";
import { data } from "../../assets/dissolveShader";
import { useFrame } from "@react-three/fiber";

const Container = styled.div`
  font-family: "Geomatic";
  display: flex;
  position: absolute;
  justify-content: center;
  align-items: center;
  font-size: 4rem;
  pointer-events: none;
`;

interface Landing {
  svg?: boolean;
}

export default function Name({ svg = false }: Landing) {
  const [blend, setBlend] = useState(false);
  useEffect(() => {
    setTimeout(() => {
      setBlend(true);
    }, 1000);
  }, []);

  const material = useRef<any>(null!);
  const scroll = useScroll();
  useFrame(() => {
    const r2 = scroll.range(0, 1);
    if (material.current === null) return;
    material.current.uniforms.Dissolve_Factor.value = r2 * 2;
  });

  if (svg) {
    return (
      <Html
        position={[0, 0, -20]}
        occlude={blend ? "blending" : true}
        zIndexRange={[100, 0]}
      >
        <Container>
          <Icon />
        </Container>
      </Html>
    );
  } else {
    return (
      <Text
        anchorX="center"
        anchorY="middle"
        font={Geomatic}
        position={[0, -0.035, -5]}
        scale={0.63}
        castShadow
      >
        Andrew Cao
        <NodeToyMaterial data={data} ref={material} />
      </Text>
    );
  }
}

const NameOutline = styled(motion.svg)`
  position: absolute;
  height: 14.6vh;
  path {
    stroke-width: 1px;
    stroke-linecap: round;
    fill: transparent;
  }
`;

const draw = {
  hidden: { pathLength: 0, opacity: 0 },
  visible: (i: number) => {
    const delay = i;
    return {
      pathLength: 1,
      opacity: 1,
      transition: {
        pathLength: { delay, type: "spring", duration: 10, bounce: 0 },
        opacity: { delay, duration: 0.01 },
      },
    };
  },
};

function Icon() {
  return (
    <NameOutline
      id="b"
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 428.57 53.57"
      initial="hidden"
      animate="visible"
    >
      <g id="c">
        <motion.path
          d="m25.68,3.56l16.15,46.45h-6.66l-3.93-11.38-.47-1.35h-15.55l-.46,1.35-3.9,11.37h-6.66L20.37,3.56h5.31m-8.49,27.98h11.66l-.92-2.65-3.02-8.75-1.89-5.47-1.89,5.47-3.02,8.75-.92,2.65M27.11,1.56h-8.16L1.41,52.01h10.9l4.36-12.73h12.69l4.39,12.73h10.9L27.11,1.56h0Zm-7.1,27.98l3.02-8.75,3.02,8.75h-6.05Z"
          stroke="#000000"
          variants={draw}
          custom={0.2}
        />
        <motion.path
          stroke="#000000"
          variants={draw}
          custom={0.8}
          d="m84.13,3.56v46.45h-5.16l-18.22-28.78-3.71-5.87.02,6.94.1,27.7h-5.94V3.56h5.06l18.29,28.71,3.69,5.79V3.56h5.88m2-2h-9.88v29.64L57.38,1.56h-8.16v50.45h9.95l-.11-29.71,18.81,29.71h8.26V1.56h0Z"
        />
        <motion.path
          stroke="#000000"
          variants={draw}
          custom={0.6}
          d="m106.99,3.56c4.26.11,8.15,1.22,11.58,3.28,3.45,2.08,6.24,4.9,8.29,8.38,2.04,3.46,3.08,7.33,3.08,11.52s-1.04,8.11-3.1,11.59c-2.07,3.51-4.86,6.34-8.3,8.43-3.42,2.08-7.31,3.17-11.53,3.26h-14.31V3.56h14.29m-8.37,40.75h8.04c3.11,0,6.01-.82,8.64-2.44,2.59-1.59,4.69-3.73,6.24-6.36,1.57-2.66,2.37-5.61,2.37-8.77s-.8-6.03-2.38-8.66c-1.56-2.59-3.66-4.7-6.26-6.26-2.63-1.58-5.53-2.38-8.62-2.38h-8.08v2s.04,30.87.04,30.87v2M107.02,1.56h-16.31v50.45h16.31c4.64-.09,8.83-1.28,12.57-3.55,3.74-2.27,6.73-5.31,8.98-9.12,2.25-3.81,3.38-8.01,3.38-12.6s-1.12-8.75-3.36-12.53c-2.24-3.78-5.23-6.81-8.98-9.07-3.75-2.26-7.95-3.45-12.59-3.57h0Zm-6.4,40.75l-.04-30.87h6.08c2.74,0,5.27.7,7.59,2.09,2.32,1.39,4.18,3.25,5.57,5.57,1.39,2.32,2.09,4.86,2.09,7.63s-.7,5.4-2.09,7.75c-1.39,2.36-3.25,4.25-5.57,5.68-2.32,1.43-4.85,2.14-7.59,2.14h-6.05Z"
        />
        <motion.path
          stroke="#000000"
          variants={draw}
          custom={0}
          d="m151.74,3.42c3.02.09,5.77.88,8.18,2.34,2.43,1.48,4.4,3.49,5.86,5.97,1.44,2.45,2.17,5.21,2.17,8.18,0,2.75-.62,5.34-1.85,7.69-1.23,2.35-3,4.34-5.28,5.93l-.15.1-.05.05c-.09.06-.35.23-1,.6h-.03s-.03.03-.03.03c-.51.31-1.25.66-2.21,1.04l-2.53.99,1.7,2.12,9.25,11.55h-7.3l-10.44-12.7-3.55-4.31v17.01h-5.98V3.42h13.23m-7.24,27.07h6.96c2.91,0,5.42-1.04,7.48-3.1,2.06-2.06,3.1-4.57,3.1-7.48s-1.04-5.38-3.1-7.43c-2.06-2.04-4.57-3.08-7.47-3.08h-6.96v21.09m7.27-29.07h-15.26v50.59h9.98v-13.43l11.04,13.43h12.41l-11.85-14.8c1.08-.42,1.92-.82,2.53-1.2.77-.44,1.22-.73,1.34-.84,2.55-1.78,4.52-4,5.91-6.64,1.38-2.65,2.07-5.52,2.07-8.61,0-3.35-.81-6.42-2.44-9.19-1.63-2.78-3.81-5-6.54-6.66-2.73-1.66-5.8-2.54-9.19-2.64h0Zm-5.27,27.07V11.41h4.96c2.37,0,4.39.83,6.06,2.5,1.68,1.66,2.51,3.67,2.51,6.01s-.84,4.39-2.51,6.06-3.7,2.51-6.06,2.51h-4.96Z"
        />
        <motion.path
          stroke="#000000"
          variants={draw}
          custom={0.9}
          d="m205.91,3.56v5.67h-23.62v14.48h22.11v5.74h-22.11v14.79h23.62v5.77h-29.4V3.56h29.4m2-2h-33.4v50.45h33.4v-9.77h-23.62v-10.79h22.11v-9.74h-22.11v-10.48h23.62V1.56h0Z"
        />
        <motion.path
          stroke="#000000"
          variants={draw}
          custom={0.3}
          d="m268.6,3.56l-10.97,46.45h-5.42l-8.54-21.93-1.86-4.79-1.86,4.79-8.54,21.93h-5.42l-10.97-46.45h6.57l6.5,28.02,1.47,6.34,2.34-6.07,7.24-18.76h5.38l7.21,18.76,2.34,6.09,1.47-6.36,6.5-28.02h6.57m2.53-2h-10.69l-6.86,29.57-7.7-20.04h-8.12l-7.73,20.04-6.86-29.57h-10.69l11.92,50.45h8.37l9.04-23.2,9.04,23.2h8.37l11.92-50.45h0Z"
        />
        <motion.path
          stroke="#000000"
          variants={draw}
          custom={0.5}
          d="m317.92,3c3.07,0,6.06.66,8.88,1.96,2.84,1.31,5.35,3.19,7.47,5.59l1.05,1.19-4.18,4.18-1.17-1.3c-3.41-3.88-7.46-5.85-12.05-5.85-2.99,0-5.78.85-8.3,2.53-2.45,1.64-4.44,3.83-5.92,6.52-1.48,2.7-2.23,5.71-2.23,8.94v.07c0,4.68,1.65,8.92,4.89,12.61l.03.03.03.03c3.35,3.49,7.22,5.25,11.5,5.25,4.59,0,8.64-1.95,12.03-5.79l1.19-1.32,4.18,4.18-1.04,1.19c-2.12,2.4-4.64,4.28-7.48,5.59-2.83,1.3-5.82,1.96-8.88,1.96-4.07,0-7.83-1.07-11.17-3.17-3.38-2.13-6.12-5.03-8.15-8.63-2.02-3.58-3.05-7.61-3.05-12.01,0-3.16.57-6.21,1.69-9.08,1.12-2.86,2.77-5.46,4.9-7.72,2.12-2.25,4.57-4,7.26-5.18,2.68-1.18,5.55-1.78,8.51-1.78m0-2c-3.26,0-6.36.65-9.32,1.95s-5.59,3.18-7.91,5.64-4.09,5.25-5.31,8.37c-1.22,3.12-1.83,6.39-1.83,9.81v.04c0,4.73,1.1,9.05,3.3,12.96s5.14,7.01,8.82,9.33,7.76,3.48,12.23,3.48c3.38,0,6.62-.71,9.72-2.14,3.11-1.43,5.82-3.46,8.14-6.08l2.29-2.6-7-7-2.6,2.88c-3.02,3.42-6.54,5.13-10.55,5.13-3.73,0-7.08-1.55-10.05-4.64-2.93-3.33-4.39-7.09-4.39-11.29v-.07c0-2.91.66-5.57,1.99-7.98,1.32-2.41,3.08-4.35,5.27-5.82,2.19-1.46,4.59-2.2,7.19-2.2,4.01,0,7.52,1.72,10.55,5.17l2.6,2.88,7-7-2.29-2.6c-2.32-2.62-5.03-4.65-8.14-6.08-3.11-1.43-6.35-2.14-9.72-2.14h0Z"
        />
        <motion.path
          stroke="#000000"
          variants={draw}
          custom={0.7}
          d="m362.69,3.56l16.15,46.45h-6.66l-3.93-11.38-.47-1.35h-15.55l-.46,1.35-3.9,11.37h-6.66l16.15-46.45h5.31m-8.49,27.98h11.66l-.92-2.65-3.02-8.75-1.89-5.47-1.89,5.47-3.02,8.75-.92,2.65m9.91-29.98h-8.16l-17.54,50.45h10.9l4.36-12.73h12.69l4.39,12.73h10.9L364.11,1.56h0Zm-7.1,27.98l3.02-8.75,3.02,8.75h-6.05Z"
        />
        <motion.path
          stroke="#000000"
          variants={draw}
          custom={0.2}
          d="m403.21,3c4.07,0,7.84,1.07,11.19,3.17,3.39,2.13,6.13,5.03,8.14,8.62,2.01,3.58,3.03,7.61,3.03,11.98s-1.02,8.39-3.03,11.98c-2.02,3.59-4.76,6.5-8.15,8.64-3.35,2.12-7.11,3.19-11.18,3.19s-7.83-1.07-11.18-3.19c-3.39-2.14-6.13-5.05-8.15-8.64-2.01-3.58-3.03-7.61-3.03-11.98s1.02-8.39,3.03-11.98c2.02-3.59,4.76-6.49,8.14-8.62,3.35-2.11,7.11-3.17,11.19-3.17m0,41.77c3.02,0,5.83-.87,8.35-2.58,2.45-1.67,4.44-3.9,5.9-6.64,1.46-2.74,2.2-5.78,2.2-9.03s-.74-6.22-2.2-8.89c-1.46-2.66-3.44-4.82-5.89-6.4-2.5-1.61-5.31-2.43-8.36-2.43s-5.83.82-8.34,2.43c-2.47,1.58-4.46,3.74-5.91,6.4-1.46,2.67-2.2,5.66-2.2,8.89s.75,6.29,2.23,9.03c1.47,2.74,3.46,4.97,5.91,6.63,2.52,1.71,5.32,2.58,8.31,2.58m0-43.77c-4.48,0-8.56,1.16-12.25,3.48s-6.63,5.43-8.82,9.33-3.29,8.22-3.29,12.96,1.1,9.05,3.29,12.96,5.13,7.02,8.82,9.35c3.69,2.33,7.78,3.5,12.25,3.5s8.56-1.17,12.25-3.5c3.69-2.33,6.63-5.45,8.82-9.35s3.29-8.22,3.29-12.96-1.1-9.05-3.29-12.96-5.13-7.01-8.82-9.33-7.78-3.48-12.25-3.48h0Zm0,41.77c-2.6,0-5-.74-7.19-2.23-2.19-1.49-3.95-3.46-5.27-5.92s-1.99-5.16-1.99-8.09.65-5.55,1.95-7.93c1.3-2.38,3.05-4.27,5.24-5.68s4.61-2.11,7.26-2.11,5.1.7,7.28,2.11,3.92,3.3,5.22,5.68c1.3,2.38,1.95,5.02,1.95,7.93s-.66,5.62-1.97,8.09-3.06,4.44-5.26,5.92c-2.19,1.49-4.6,2.23-7.22,2.23h0Z"
        />
      </g>
    </NameOutline>
  );
}
